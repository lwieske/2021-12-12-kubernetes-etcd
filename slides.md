---
marp: true
---

<!-- _class: invert -->

## Kubernetes

* Kubernetes, also known as K8s, is an open-source system for automating
  deployment, scaling, and management of containerized applications.

* It groups containers that make up an application into logical units for easy
  management and discovery. Kubernetes builds upon 15 years of experience of
  running production workloads at Google, combined with best-of-breed ideas and
  practices from the community.

---

![](https://d33wubrfki0l68.cloudfront.net/2475489eaf20163ec0f54ddc1d92aa8d4c87c96b/e7c81/images/docs/components-of-kubernetes.svg)

---

## Kubernetes Etcd - Kubernetes Backing Store

* etcd is a consistent and highly-available distributed key value store used as
  Kubernetes' backing store for all cluster data.

---

## The Other Common Choice For Distributed Consensus

* Apache Curator / Zookeeper

---

## Etcd - Key Value Store

* etcd is a consistent and durable distributed key value store.

  * Read APIs
    * range
    * watch

  * Write APIs
    * put
    * delete

  * Combination (read-modify-write) APIs
    * txn

---

## Etcd - Operation Completed

* An etcd operation is considered complete when it is committed through
  consensus, and therefore “executed” – permanently stored – by the etcd storage
  engine. The client knows an operation is completed when it receives a response
  from the etcd server. Note that the client may be uncertain about the status
  of an operation if it times out, or there is a network disruption between the
  client and the etcd member. etcd may also abort operations when there is a
  leader election. etcd does not send abort responses to clients’ outstanding
  requests in this event.

---

## Etcd - Revisions

* An etcd operation that modifies the key value store is assigned a single
  increasing revision. A transaction operation might modify the key value store
  multiple times, but only one revision is assigned. The revision attribute of a
  key value pair that was modified by the operation has the same value as the
  revision of the operation. The revision can be used as a logical clock for key
  value store. A key value pair that has a larger revision is modified after a
  key value pair with a smaller revision. Two key value pairs that have the same
  revision are modified by an operation “concurrently”.

---

## Etcd Guarantees

* Atomicity

  * All API requests are atomic; an operation either completes entirely or not
    at all. For watch requests, all events generated by one operation will be in
    one watch response. Watch never observes partial events for a single
    operation.

* Consistency

  * All API calls ensure sequential consistency, the strongest consistency
    guarantee available from distributed systems. No matter which etcd member
    server a client makes requests to, a client reads the same events in the
    same order. If two members complete the same number of operations, the state
    of the two members is consistent.

---

## Etcd Guarantees (II)

* Consistency ...

  * For watch operations, etcd guarantees to return the same value for the same
    key across all members for the same revision. For range operations, etcd has
    a similar guarantee for linearized access; serialized access may be behind
    the quorum state, so that the later revision is not yet available.

  * As with all distributed systems, it is impossible for etcd to ensure strict
    consistency. etcd does not guarantee that it will return to a read the “most
    recent” value (as measured by a wall clock when a request is completed)
    available on any cluster member.

---

## Etcd Guarantees (III)

* Isolation

  * etcd ensures serializable isolation, which is the highest isolation level
    available in distributed systems. Read operations will never observe any
    intermediate data.

* Durability

  * Any completed operations are durable. All accessible data is also durable
    data. A read will never return data that has not been made durable.

---

## Etcd Guarantees (IV)

* Linearizability

  * Linearizability (also known as Atomic Consistency or External Consistency)
    is a consistency level between strict consistency and sequential
    consistency.

  * For linearizability, suppose each operation receives a timestamp from a
    loosely synchronized global clock. Operations are linearized if and only if
    they always complete as though they were executed in a sequential order and
    each operation appears to complete in the order specified by the program.
    Likewise, if an operation’s timestamp precedes another, that operation must
    also precede the other operation in the sequence.

---

## Etcd Guarantees (V)

* Linearizability ...

  * For example, consider a client completing a write at time point 1 (t1). A
    client issuing a read at t2 (for t2 > t1) should receive a value at least as
    recent as the previous write, completed at t1. However, the read might
    actually complete only by t3. Linearizability guarantees the read returns
    the most current value. Without linearizability guarantee, the returned
    value, current at t2 when the read began, might be “stale” by t3 because a
    concurrent write might happen between t2 and t3.

---

## Etcd Guarantees (VI)

* Linearizability ...

  * etcd does not ensure linearizability for watch operations. Users are
    expected to verify the revision of watch responses to ensure correct
    ordering.

  * etcd ensures linearizability for all other operations by default.
    Linearizability comes with a cost, however, because linearized requests must
    go through the Raft consensus process. To obtain lower latencies and higher
    throughput for read requests, clients can configure a request’s consistency
    mode to serializable, which may access stale data with respect to quorum,
    but removes the performance penalty of linearized accesses' reliance on live
    consensus.

---

<!-- _class: invert -->

## Kubernetes Etcd Demo

* We navigate the etcd API with the client *etcdctl*.

* We will see how to find the key value store.

* And we will retrieve in turn some keys and values. 
